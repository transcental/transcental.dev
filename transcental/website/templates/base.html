<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	{% block head %}
	<title>{% block title %}{% endblock %} - amber's abode</title>
	{% endblock %}
	<style>
	body {
	    font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1e1e1e;
        color: #f0f0f0;
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        width: 100vw;
	}
	nav {
	    background-color: #78350f;
        color: white;
        padding: 10px;
        display: flex;
	}
	nav a {
        color: white;
        text-decoration: none;
        margin: 0 10px;
    }
    nav a:hover {
        text-decoration: underline;
    }

	.light {
		width: 50%;
		margin: auto;
        z-index: -1;
        position: absolute;
        opacity: 1;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        & object {
            transform: rotate(180deg);
        }
      }
	</style>
</head>
<body>
    {% block navbar %}
    <nav>
        <div style="flex-grow: 1;">
        <a href="/"><strong>amber's abode</strong></a>
        <a href="/projects">Projects</a>
        <a href="/gallery">Photography</a>
        <a href="/contact">Contact</a>
        <a href="/contact">Blog</a>
        </div>
        <div style="text-align: right;">
        <a href="https://github.com/transcental" target="_blank">GitHub</a>
        </div>
    </nav>
    {% endblock %}
    <div class="light">
        <object id="bulb" type="image/svg+xml" data="/static/light.svg" ></object>
    </div>
    {% block content %}
	<h1>hiii</h1>
	<p>this is template content, you probably want to chnge this!</p>
	{% endblock %}
	<script>
     	const ws = new WebSocket("ws://" + window.location.host + "/ws");
     	const lightObj = document.querySelector('#bulb');
        let lightSvg = null;
        let queuedColour = null;
        
        function applyColour(colour) {
          if (lightSvg) {
            try {
              lightSvg.style.fill = colour;
              return;
            } catch (e) {
              console.error("couldn't apply colour to svg", e);
            }
          }
        }
        
        lightObj.addEventListener('load', () => {
          lightSvg = lightObj.contentDocument.querySelector('svg');
          if (queuedColour) {
            applyColour(queuedColour);
            queuedColour = null;
          }
        })
        
     	ws.onmessage = function(event) {
       	    data = JSON.parse(event.data).light;
            console.log(data);
         	if (!lightSvg & !(lightObj.contentDocument)) {
              queuedColour = data.colour;
            } else {
              applyColour(data.colour);
            }
      };
	</script>
</body>
</html>
